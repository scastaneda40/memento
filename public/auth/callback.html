<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Signing you inâ€¦</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: light dark;
      }
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        padding: 24px;
      }
    </style>
  </head>
  <body>
    <p>Signing you inâ€¦</p>

    <script type="module">
      import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

      // ðŸ”´ Replace with your real values (no envs in /public)
      const SUPABASE_URL = "https://glpztusxruugdvujcitc.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdscHp0dXN4cnV1Z2R2dWpjaXRjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2NTYxMzEsImV4cCI6MjA3MzIzMjEzMX0.qiB9SfjOYzkIKv2D_vap_9hgTvpVzJIZuWFPPSMXrrU";

      // Let the SDK do the PKCE exchange on this static page
      const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
        auth: {
          flowType: "pkce",
          persistSession: true,
          autoRefreshToken: true,
          detectSessionInUrl: true, // <-- important here
        },
      });

      try {
        // This triggers the exchange if ?code=... is present
        const { data, error } = await supabase.auth.getSession();
        if (error) throw error;

        // Go back to the SPA
        const origin = window.location.origin;
        window.location.replace(`${origin}/#/dashboard`);
      } catch (e) {
        console.error("[callback] auth error:", e?.message || e);
        const origin = window.location.origin;
        window.location.replace(`${origin}/#/auth`);
      }

      console.log("[callback] loaded", window.location.href);
      const { data, error } = await supabase.auth.getSession();
      console.log("[callback] getSession result", {
        hasSession: !!data?.session,
        error: error?.message,
      });
    </script>
  </body>
</html>
